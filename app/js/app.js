!function(e){"use strict";e._qs=function(e,n){return(n||document).querySelector(e)},e._qsa=function(e,n){return(n||document).querySelectorAll(e)},e._on=function(e,n,t,r){e.addEventListener(n,t,!!r)},e._delegate=function(n,t,r,o){function a(r){var a=r.target,u=e._qsa(t,n),c=Array.prototype.indexOf.call(u,a)>=0;c&&o.call(a,r)}var u="blur"===r||"focus"===r;e._on(n,r,a,u)},e._parent=function(n,t){return n.parentNode&&n.parentNode!==document?n.parentNode.tagName.toLowerCase()===t.toLowerCase()?n.parentNode:e._parent(n.parentNode,t):void 0},e.indexOf=function(e,n){return Array.prototype.indexOf.call(e,n)}}(window);
!function(t,a,s){"use strict";function r(t){var a=this;a.storageKey=t,localStorage[a.storageKey]?a.data=JSON.parse(localStorage[a.storageKey]):a.data={users:[],groups:[]},localStorage[a.storageKey]=JSON.stringify(a.data)}r.prototype.getUsers=function(){return this.data=JSON.parse(localStorage[this.storageKey]),this.data.users},r.prototype.getUser=function(t){this.data=JSON.parse(localStorage[this.storageKey]);for(var a=0;a<this.data.users.length;a++)if(this.data.users[a].id==t)return this.data.users[a];return!0},r.prototype.getGroups=function(){return this.data=JSON.parse(localStorage[this.storageKey]),this.data.groups},r.prototype.getGroup=function(t){return this.data=JSON.parse(localStorage[this.storageKey]),this.data.groups.forEach(function(a,s){return a.id==t?a:void 0}),!1},r.prototype.removeUser=function(t,a){var s=this;a=a||function(){},s.data=JSON.parse(localStorage[s.storageKey]),s.data.groups.forEach(function(a,r){a.users.forEach(function(a,e){s.data.groups[r].users[e]==t&&s.data.groups[r].users.splice(e,1)})});for(var r=0;r<s.data.users.length;r++)if(s.data.users[r].id==t)return s.data.users.splice(r,1),localStorage[s.storageKey]=JSON.stringify(s.data),a(),!1;return!0},r.prototype.removeGroup=function(t,a){a=a||function(){},this.data=JSON.parse(localStorage[this.storageKey]);for(var s=0;s<this.data.groups.length;s++)if(this.data.groups[s].id==t)return this.data.groups[s].users.length?!0:(this.data.groups.splice(s,1),localStorage[this.storageKey]=JSON.stringify(this.data),a(),!1);return!0},r.prototype.addUser=function(t,a){a=a||function(){};var s={id:(new Date).getTime(),name:t};this.data=JSON.parse(localStorage[this.storageKey]),this.data.users.push(s),localStorage[this.storageKey]=JSON.stringify(this.data),a()},r.prototype.addGroup=function(t,a){a=a||function(){};var s={id:(new Date).getTime(),name:t,users:[]};this.data=JSON.parse(localStorage[this.storageKey]),this.data.groups.push(s),localStorage[this.storageKey]=JSON.stringify(this.data),a()},r.prototype.toggleGroupAssociativity=function(t,a,s){s=s||function(){},this.data=JSON.parse(localStorage[this.storageKey]);for(var r=0;r<this.data.groups.length;r++)if(this.data.groups[r].id==a){var e=this.data.groups[r].users.indexOf(t);-1==e?this.data.groups[r].users.push(t):this.data.groups[r].users.splice(e,1),localStorage[this.storageKey]=JSON.stringify(this.data),s()}return!0},t.app=t.app||{},t.app.Model=r}(this,document);
!function(e,r,t){"use strict";function o(e,r){var t=this;t.model=e,t.view=r,t.view.talk("addUser",function(e){e.trim().length>0&&t.model.addUser(e.trim(),function(){t.render("users")})}),t.view.talk("deleteUser",function(e){e&&t.model.removeUser(e,function(){t.render()})}),t.view.talk("addGroup",function(e){e.trim().length>0&&t.model.addGroup(e.trim(),function(){t.render()})}),t.view.talk("deleteGroup",function(e){var r=t.model.getGroup(e);r.users&&r.users.length||t.model.removeGroup(e,function(){t.render()})}),t.view.talk("userGroupToggle",function(e,r){e&&r&&t.model.toggleGroupAssociativity(e,r,function(){t.render()})})}o.prototype.render=function(e){var r=this,t=r.model.getGroups(),o=r.model.getUsers(),n=r.model.getGroups();switch(n.forEach(function(e,t){n[t].users.forEach(function(e,o){n[t].users[o]=r.model.getUser(e)})}),e){case"users":r.view.renderUsers(o,t);break;case"groups":r.view.renderGroups(n);break;default:r.view.renderUsers(o,t),r.view.renderGroups(n)}return!1},o.prototype.init=function(e){e=e||function(){};var r=this;r.render(),e()},e.app=e.app||{},e.app.Controller=o}(this,document);
!function(e,t,s){"use strict";function r(e){var t=this;t.$groupList=_qs(e.groupList),t.$groupListNotice=_qs(e.groupListNotice),t.$userList=_qs(e.userList),t.$userListNotice=_qs(e.userListNotice),t.$addUserForm=_qs(e.addUserForm),t.$addGroupForm=_qs(e.addGroupForm)}function i(e,t){e=e||{},t=t||[];for(var s='<li class="users__item" data-id="'+e.id+'">	<span class="users__item__name">		<svg class="users__item__name__icon">		    <use xlink:href="#user"></use>		</svg>		'+e.name+'	</span>	<div class="users__item__actions">		<a href="#" class="user-item__action user-item__action--delete"  data-id="'+e.id+'">			<svg class="user-item__action__icon">			    <use xlink:href="#delete"></use>			</svg>			<span class="user-item__action__title">Delete</span>		</a>		<h3 class="user-item__groups-head">Groups:</h3>',r=0;r<t.length;r++){var i=t[r].users.indexOf(e.id)>-1?" user-item__group-selector--selected":"";s+='		<label class="user-item__group-selector'+i+'"		data-group-id="'+t[r].id+'" data-user-id="'+e.id+'">			<svg class="user-item__group-selector__icon">			    <use xlink:href="#assign"></use>			</svg>			<input type="checkbox">			'+t[r].name+"		</label>"}return s+="	</div></li>"}function a(e){e=e||{};var t=e.users,s='<li class="group-item" data-group-id="'+e.id+'">	<h3 class="group-item__name">		'+e.name+"	</h3>";if(t.length){s+='<ul class="group-item__users">';for(var r=0;r<t.length;r++)s+='		<li class="group-item__users_i">			'+t[r].name+"		</li>";s+="</ul>"}else s+=' <p class="group-item__empty-notice"> 	This group doesn\'t have any users. You can  	<a href="#" data-group-id="'+e.id+'" class="group-item__empty-notice__link">get rid of it</a> ;) </p>';return s+="</li>"}r.prototype.talk=function(e,t){var s=this;return e=e||"",t=t||function(){},"addUser"==e&&_on(s.$addUserForm,"submit",function(e){e.preventDefault();var r=_qs('input[type="text"]',s.$addUserForm);return t(r.value),r.value="",!1}),"deleteUser"==e&&s.$userList.addEventListener("click",function(e){var s=_parent(e.target,"a");if("A"==e.target.tagName&&indexOf(e.target.classList,"user-item__action--delete")>-1)var r=e.target;else if(s&&indexOf(s.classList,"user-item__action--delete")>-1)var r=s;return r?(e.preventDefault(),t(parseInt(r.dataset.id,10)),!1):void 0}),"addGroup"==e&&_on(s.$addGroupForm,"submit",function(e){e.preventDefault();var r=_qs('input[type="text"]',s.$addGroupForm);return t(r.value),r.value="",!1}),"deleteGroup"==e&&_delegate(s.$groupList,".group-item__empty-notice__link","click",function(e){return e.preventDefault(),t(parseInt(this.getAttribute("data-group-id"),10)),!1}),"userGroupToggle"==e&&_delegate(s.$userList,".user-item__group-selector","click",function(e){return e.preventDefault(),t(parseInt(this.getAttribute("data-user-id"),10),parseInt(this.getAttribute("data-group-id"),10)),!1}),!1},r.prototype.renderUsers=function(e,t){e=e||[],t=t||[];var s="";this.$userListNotice.style.display="none";for(var r=0;r<e.length;r++)s+=i(e[r],t);this.$userList.innerHTML=s,e.length||(this.$userListNotice.style.display="block")},r.prototype.renderGroups=function(e){e=e||[];var t=this,s="";t.$groupListNotice.style.display="none",e.forEach(function(e,t){s+=a(e,e.users)}),t.$groupList.innerHTML=s,e.length||(t.$groupListNotice.style.display="block")},e.app=e.app||{},e.app.View=r}(this,document);
!function(s,e,i){"use strict";function t(){requestAnimationFrame(function(){var s=_qs("#main");s.classList?s.classList.add("main--loaded"):s.className+=" main--loaded"})}var o=new app.View({groupList:"#groups-list",groupListNotice:"#groups-empty-notice",userList:"#users-list",userListNotice:"#users-empty-notice",addGroupForm:"#add-group-form",addUserForm:"#add-user-form"}),r=new app.Model("internations_db"),a=new app.Controller(r,o);a.init(t)}(this,document);